<!DOCTYPE html>
<html>
<head>
    <title>Leave Gantt Chart - Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Leave Gantt Chart - Simple Test Page</h1>
        <p>This page tests the basic functionality of the Leave Gantt Chart without the full Frappe environment.</p>
        
        <div class="status info">
            <strong>Test Status:</strong> <span id="test-status">Ready to test</span>
        </div>
        
        <div>
            <button onclick="testBasicFunctionality()">Test Basic Functionality</button>
            <button onclick="testDHTMLXGantt()">Test DHTMLX Gantt Loading</button>
            <button onclick="testAPICall()">Test API Call (if in Frappe)</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="test-results" class="test-results" style="display: none;">
            <h3>Test Results:</h3>
            <div id="results-content"></div>
        </div>
        
        <div id="gantt-test-container" style="height: 400px; border: 1px solid #ddd; margin-top: 20px; display: none;">
            <div id="gantt_here" style="width: 100%; height: 100%;"></div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('results-content');
            const statusSpan = document.getElementById('test-status');
            const testResults = document.getElementById('test-results');
            
            testResults.style.display = 'block';
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            resultsDiv.appendChild(logEntry);
            statusSpan.textContent = message;
            
            // Scroll to bottom
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results-content').innerHTML = '';
            document.getElementById('test-results').style.display = 'none';
            document.getElementById('test-status').textContent = 'Ready to test';
        }

        function testBasicFunctionality() {
            log('Testing basic JavaScript functionality...', 'info');
            
            try {
                // Test basic JavaScript
                const testArray = [1, 2, 3];
                const testObject = { name: 'test', value: 123 };
                
                if (testArray.length === 3 && testObject.name === 'test') {
                    log('✓ Basic JavaScript functionality working', 'success');
                } else {
                    log('✗ Basic JavaScript test failed', 'error');
                }
                
                // Test jQuery if available
                if (typeof $ !== 'undefined') {
                    log('✓ jQuery is available', 'success');
                } else {
                    log('⚠ jQuery not available (normal for standalone test)', 'info');
                }
                
                // Test Frappe if available
                if (typeof frappe !== 'undefined') {
                    log('✓ Frappe framework is available', 'success');
                } else {
                    log('⚠ Frappe framework not available (normal for standalone test)', 'info');
                }
                
                log('Basic functionality test completed', 'success');
                
            } catch (e) {
                log('✗ Error in basic functionality test: ' + e.message, 'error');
            }
        }

        function testDHTMLXGantt() {
            log('Testing DHTMLX Gantt library loading...', 'info');
            
            try {
                if (window.gantt) {
                    log('✓ DHTMLX Gantt already loaded', 'success');
                    testGanttInitialization();
                    return;
                }
                
                // Load CSS
                const cssLink = document.createElement('link');
                cssLink.rel = 'stylesheet';
                cssLink.href = 'https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css';
                document.head.appendChild(cssLink);
                log('CSS loaded', 'info');
                
                // Load JS
                const script = document.createElement('script');
                script.src = 'https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js';
                
                script.onload = function() {
                    log('✓ DHTMLX Gantt library loaded successfully', 'success');
                    testGanttInitialization();
                };
                
                script.onerror = function() {
                    log('✗ Failed to load DHTMLX Gantt library', 'error');
                };
                
                document.head.appendChild(script);
                log('Loading DHTMLX Gantt library...', 'info');
                
            } catch (e) {
                log('✗ Error loading DHTMLX Gantt: ' + e.message, 'error');
            }
        }

        function testGanttInitialization() {
            try {
                log('Testing Gantt initialization...', 'info');
                
                // Show test container
                document.getElementById('gantt-test-container').style.display = 'block';
                
                // Basic configuration
                gantt.config.date_format = "%Y-%m-%d";
                gantt.config.columns = [
                    {name: "text", label: "Task", width: 200, tree: true},
                    {name: "start_date", label: "Start", width: 100},
                    {name: "duration", label: "Duration", width: 80}
                ];
                
                // Initialize
                gantt.init("gantt_here");
                
                // Add sample data
                const sampleData = {
                    data: [
                        {id: 1, text: "Sample Company", type: "project", open: true, start_date: "2025-01-01", duration: 30},
                        {id: 2, text: "John Doe", parent: 1, start_date: "2025-01-01", duration: 1},
                        {id: 3, text: "Annual Leave", parent: 2, start_date: "2025-01-15", duration: 5}
                    ]
                };
                
                gantt.parse(sampleData);
                
                log('✓ Gantt chart initialized successfully with sample data', 'success');
                
            } catch (e) {
                log('✗ Error initializing Gantt: ' + e.message, 'error');
            }
        }

        function testAPICall() {
            if (typeof frappe === 'undefined') {
                log('⚠ Cannot test API call - Frappe framework not available', 'info');
                return;
            }
            
            log('Testing API call...', 'info');
            
            try {
                frappe.call({
                    method: 'svg_mobile_app.svg_mobile_app.page.leave_gantt_chart.leave_gantt_chart.get_leave_gantt_data',
                    callback: function(r) {
                        if (r.message) {
                            log('✓ API call successful - received data', 'success');
                            log(`Data summary: ${r.message.summary?.total_companies || 0} companies, ${r.message.summary?.total_employees || 0} employees, ${r.message.summary?.total_leaves || 0} leaves`, 'info');
                        } else {
                            log('⚠ API call successful but no data returned', 'info');
                        }
                    },
                    error: function(r) {
                        log('✗ API call failed: ' + (r.message || 'Unknown error'), 'error');
                    }
                });
            } catch (e) {
                log('✗ Error making API call: ' + e.message, 'error');
            }
        }

        // Auto-run basic test on page load
        window.onload = function() {
            log('Page loaded - ready for testing', 'info');
        };
    </script>
</body>
</html>
